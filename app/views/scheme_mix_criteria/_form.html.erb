<div class="row">
    <div class="col-lg-6">
        <div class="ibox">
            <div class="ibox-title">
                <h5>Criterion details</h5>
            </div>
            <div class="ibox-content">
                <%= bootstrap_form_for([@project, @certification_path, @scheme_mix, @scheme_mix_criterion], url: project_certification_path_scheme_mix_scheme_mix_criterion_path) do |f| %>
                    <% if @scheme_mix_criterion.errors.any? %>
                        <div id="error_explanation">
                            <h2><%= pluralize(@scheme_mix_criterion.errors.count, "error") %> prohibited this criterion from being saved:</h2>
                            <ul>
                                <% @scheme_mix_criterion.errors.full_messages.each do |message| %>
                                    <li><%= message %></li>
                                <% end %>
                            </ul>
                        </div>
                    <% end %>
                    <div class="row">
                        <div class="col-md-3">
                            <% if can? :manage, @scheme_mix_criterion %>
                                <%= f.select :targeted_score, @scheme_mix_criterion.scheme_criterion.scores.map { |k| [k.score, k.score]} %>
                            <% else %>
                                <%= f.static_control :targeted_score %>
                            <% end %>
                        </div>
                        <div class="col-md-3">
                            <%= f.static_control :submitted_score %>
                        </div>
                        <div class="col-md-3">
                            <% if can? :manage, @scheme_mix_criterion %>
                                <%= f.select :achieved_score, @scheme_mix_criterion.scheme_criterion.scores.map { |k| [k.score, k.score]}, {include_blank: 'Unclassified'}, disabled: true %>
                            <% else %>
                                <% if !@scheme_mix_criterion.certifier.nil? && @scheme_mix_criterion.certifier.id == current_user.id %>
                                    <%= f.select :achieved_score, @scheme_mix_criterion.scheme_criterion.scores.map { |k| [k.score, k.score]}, {include_blank: 'Unclassified'} %>
                                <% else %>
                                    <%= f.static_control :achieved_score %>
                                <% end %>
                            <% end %>
                        </div>
                        <div class="col-md-3">
                            <%= f.static_control label: 'Status' do @scheme_mix_criterion.status.humanize end %>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="hr-line-dashed"></div>
                            <% if can? :manage, @scheme_mix_criterion %>
                                <%= f.primary 'Save' %>
                                <button type="button" class="btn btn-white" data-toggle="modal" data-target="#updateCriterionStatusModal">Update status</button>
                            <% end %>
                            <%= link_to 'Show status log', project_certification_path_scheme_mix_scheme_mix_criterion_status_logs_path(@project, @certification_path, @scheme_mix, @scheme_mix_criterion), remote: true, class: 'btn btn-white' %>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
        <% if current_user.system_admin? %>
            <div class="ibox">
                <div class="ibox-title">
                    <h5>Certifier</h5>
                </div>
                <div class="ibox-content">
                    <p>TODO : provide form to assign certifier to this criterion</p>
                </div>
            </div>
        <% end %>
        <div class="ibox">
            <div class="ibox-title">
                <h5>Requirements</h5>
            </div>
            <div class="ibox-content">
                <div class="row">
                    <div class="col-md-12">
                        <div id="accordion" class="panel-group">
                            <%= render 'requirements/update', scheme_mix_criterion: @scheme_mix_criterion %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="ibox">
            <div class="ibox-title">
                <h5>Upload documentation</h5>
            </div>
            <div class="ibox-content">
                <%= render 'documents/new', document: Document.new, scheme_mix: @scheme_mix, scheme_mix_criterion_id: @scheme_mix_criterion.id, project: @project %>
            </div>
        </div>
        <div class="ibox">
            <div class="ibox-title">
                <h5>Documentation</h5>
            </div>
            <div class="ibox-content">
                <%= render 'documents/index', documents: @scheme_mix_criterion.documents, project: @project %>
            </div>
        </div>
    </div>
</div>
<% if can? :manage, @scheme_mix_criterion %>
<%= render 'modal', project: @project, certification_path: @certification_path, scheme_mix: @scheme_mix, scheme_mix_criterion: @scheme_mix_criterion %>
<% end %>
<div id="showCriteriaStatusLogsModal" class="modal fade"></div>

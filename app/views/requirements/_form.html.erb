<% @scheme_mix_criterion.requirement_data.each_with_index do |requirement_datum| %>
    <div class="panel panel-default">
        <div class="panel-heading <%= 'assigned-requirement' if requirement_datum.user == current_user %>">
            <h4 class="panel-title">
                <a href="#requirement-<%= requirement_datum.id %>" data-parent="#accordion" data-toggle="collapse" class="collapsed" aria-expanded="false"><%= requirement_datum.requirement.label %></a>
            </h4>
        </div>
        <div class="panel-collapse collapse" id="requirement-<%= requirement_datum.id %>" aria-expanded="false" style="height: 0px;">
            <div class="panel-body">
                <%= bootstrap_form_tag url: project_requirement_datum_path(@project.id, requirement_datum.id), method: "put", remote: true, :html => { :multipart => true } do |f| %>
                    <% users = User.authorized_for_project(@project) %>
                    <% if (users.count > 0) && (can? :read, @project.project_authorizations.first) %>
                        <% if requirement_datum.user.nil? %>
                            <% if (can? :manage, @project.project_authorizations.first) %>
                                <%= f.select :user_id, options_for_select(users.map { |k| [k.email, k.id]}) %>
                            <% end %>
                        <% else %>
                            <%= f.select :user_id, options_for_select(users.map { |k| [k.email, k.id]}, requirement_datum.user.id), {}, disabled: !(can? :manage, @project.project_authorizations.first) %>
                        <% end %>
                    <% end %>
                    <% if requirement_datum.calculator_datum.present? %>
                        <% calculator_template = requirement_datum.calculator_datum.calculator.name.constantize.name.demodulize.downcase %>
                        <div>
                            <% if File.exist?("app/views/calculators/_#{calculator_template}.html.erb") %>
                                <%= render "calculators/#{calculator_template}", requirement_datum: requirement_datum, calculator_template: calculator_template, f: f %>
                            <% else %>
                                <%= render "calculators/general", requirement_datum: requirement_datum, calculator_template: calculator_template, f: f %>
                            <% end %>
                        </div>
                    <% end %>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="hr-line-dashed"></div>
                            <% if can? :update, requirement_datum %>
                                <%= f.primary %>
                            <% end %>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
<% end %>